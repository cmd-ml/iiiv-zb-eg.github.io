<!DOCTYPE html>
<html>
  <head>
			<title>ML Model for Bandgap of III-V Semiconductors</title>
      <meta charset="utf-8" />
      <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
      <meta name="viewport" content="width=device-width,initial-scale=1.0" />
      <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
    	<link rel="stylesheet" href="https://pyscript.net/releases/2024.4.1/core.css"> <!--most recent pyscript lib-->
    	<script type="module" src="https://pyscript.net/releases/2024.4.1/core.js"></script> <!--most recent pyscript lib-->
	    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-3.5.1.min.js"></script>
	    <script type="text/javascript">
	        Bokeh.set_log_level("info");
	    </script>
      <py-config>
				packages = ['pandas', 'joblib','scikit-learn','bokeh']
				[[fetch]]
				from = 'https://raw.githubusercontent.com/cmd-ml/iiiv.eg.zb.github.io/main/Ridge_Eg.pkl'
				name = 'eg'
				[[fetch]]
				from = 'https://raw.githubusercontent.com/cmd-ml/iiiv.eg.zb.github.io/main/Ridge_Ex.pkl'
				name = 'ex'
      </py-config>
  <style>
	.div {
	  /*border: 2px solid; */ padding: 20px; 
	  width: 450px; 
	  height: 450px; 
	  background-color: #FEFFFF;
	  display: inline-block; 
	  margin: 4px 2px; 
	  border-radius: 12px;
	  resize: both;  overflow: auto;"
	}
	</style>
  </head>
  <body style="background-color: #f9f8fd;">
  	<div style="color:#17252A; text-align:center; min-height: 50px; margin-bottom: 40px; text-overflow: ellipsis;">
    	<h1>Energy Bandgap Predictor of III-V Senary Zincblende Compounds:<br>Machine Learning Model</h1>
    </div>
		<div style="float:left; min-width:405px; max-height: 180px; color: #7dce94; margin-bottom: 0px; padding: 10px; font-size: 16px; margin: 4px 2px; border-radius: 30px; border: 4px solid;">
    	<p style="margin-top: 0px; flex-wrap: wrap; font-family: Courier New, monospace; color: #17252A;"><b>Please cite:</b><br>- Mohammad Alsalman et. al., “Bandgap Energy Prediction of Senary Zincblende III-V Semiconductor Compounds using Machine Learning,” Materials Science in Semiconductor Processing, vol. 161, p. 107461, 2023.</p>
		</div>
		<div style="float:left; width: 100%; min-width:200px; max-height: 1000px; font-size: 20px; font-size: 14px; text-align: center; font-size: 16px; margin: 0; padding:0; margin-left: 20px; color:#7dce94;" class="w3-show-inline-block">
    	<div style="min-hieght: 50px; border: none; font-size: 16px; color:#17252A; text-overflow: ellipsis; text-align:left;">
	    	<p style="font-size: 20px; margin-bottom: 0px; margin-left: 10px; height: 5px; wrap; font-family: Courier New, monospace; color:#17252A;"><b>User Guide:</b></p>
	    	<p style="font-size: 16px; margin-left: 15px; flex-wrap: wrap; font-family: Courier New, monospace; color:#17252A;">- Please wait for around 30 seconds until the webpage is loaded.<br>- If the website is not responding, please try to open the website using different web browser.<br>- If the website is not responding, please try opening it using a different web browser or check if your Internet service provider is blocking the application's executable segment.<br>- The figure of the predicted energy bandgap will appear after pressing the "Plot" button.<br> - Set of examples: <i>GaAs, Al0.5Ga0.5As, InP0.5As0.5, Al0.2Ga0.6In0.2P0.3As0.7, Al0.14Ga0.5In0.36P0.328As0.242Sb0.430.</i><br>- For plotting, only single variation will be plotted based on your inputs. Criteria are as follows:<br> 
  				i  -  If the initial compound is <i>GaAs</i> and the final compound is <i>AlAs</i>, it varies the molarity of <i>Ga</i> and <i>Al</i>.<br>  
  				ii -  If the initial compound is <i>Al0.3Ga0.7As</i> and the final compound is <i>Al0.3Ga0.7Sb</i>, it varies the molarity of <i>As</i> and <i>Sb</i>.<br>
  				iii - If the initial compound is <i>Al0.2Ga0.6In0.2P0.3As0.7</i> and the final compound is <i>Al0.6Ga0.2In0.2P0.3As0.7</i>, it varies the molarity of <i>Al</i> and <i>Ga</i> from the initial fraction to the final fraction of these two elements.
    		</p>
	    </div>
	  </div>
		<div id="operation" style="text-align:center; min-width:405px; max-height: 200px; margin-bottom: 0px; padding: 10px; font-size: 16px; margin: 4px 2px; border-radius: 30px; color: #17252A;">
			<p style="flex-wrap: wrap; font-family: Courier New, monospace;"><b>Please click on the type of prediction:</b></pre></p>
			<button id="op1" style="background-color: #7dce94; width: 100px; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 14px; font-family: Arial, Helvetica, sans-serif; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 50px;" onclick="operation1()" class="w3-btn">Single Value</button>
			<button id="op2" style="background-color: #7dce94; width: 100px; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 14px; font-family: Arial, Helvetica, sans-serif; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 50px;" onclick="operation2()" class="w3-btn">Energy Plot</button>
			  <p style="font-size: 12px; flex-wrap: wrap; font-family: Courier New, monospace; text-align: center;"><b>©2025 cmd-ml Group. (ver. 25.1)</b></p>
		</div>
    <div id="Panel1" style="float:left; width: 100%; min-width:405px; min-height: 200px; font-size: 16px; margin: 0; padding:0;">
    	<div id="Value1">
		    <p style="font-size: 16px; flex-wrap: wrap; font-family: Courier New, monospace; color:#17252A; margin-left: 20px;"><b>Type the compound of interest:</b>
		    	Configuration: <i>Al<sub>x<sub>1</sub></sub>Ga<sub>x<sub>2</sub></sub>In<sub>x<sub>3</sub></sub>P<sub>y<sub>1</sub></sub>As<sub>y<sub>2</sub></sub>Sb<sub>y<sub>3</sub></sub></i> <br>For example, <i>Al0.5Ga0.5As</i></p>
	    </div>
	    <div id="Plot">
	    <p style="font-size: 16px; flex-wrap: wrap; font-family: Courier New, monospace; color:#17252A; margin-left: 20px;"><b>Type the initial compound:</b>
	    	Configuration: <i>Al<sub>x<sub>1</sub></sub>Ga<sub>x<sub>2</sub></sub>In<sub>x<sub>3</sub></sub>P<sub>y<sub>1</sub></sub>As<sub>y<sub>2</sub></sub>Sb<sub>y<sub>3</sub></sub></i> <br>For example, <i>GaAs</i></p>
	  	</div>
	  	<input type="text" id="compound1" name="fname" style="font-family: 'DejaVu Math TeX Gyre', serif; font-size: 26px; width: 90%; height: 30%; display: block; margin: 0 auto; border-radius: 5px; border: 1px solid; color: #3d3d3f; text-align: center;"><br><br>
	  	<div id="Value2" class="w3-bar" style="text-align: center; align-items: center; display: block;">
				<button py-click="fun1" style="background-color: #7dce94; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 16px; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; width: 100px;" onclick="myPlot1()" class="w3-btn">Predict</button>
	  	</div>
	  	<p id="output1" style="font-size: 20px; font-family: Courier New, monospace; color:#17252A; text-align: center;"></p>
	    <div id="Panel2" style="text-align: center;">
		    <p id="Plot"style="font-size: 16px; flex-wrap: wrap; font-family: Courier New, monospace; color:#17252A;text-align: left; margin-left: 20p;"><b>Type the final compound:</b>
		    	Configuration: <i>Al<sub>x<sub>1</sub></sub>Ga<sub>x<sub>2</sub></sub>In<sub>x<sub>3</sub></sub>P<sub>y<sub>1</sub></sub>As<sub>y<sub>2</sub></sub>Sb<sub>y<sub>3</sub></sub></i> <br>For example, <i>AlAs</i></p>. 
		    <input type="text" id="compound2" name="fname" style="font-family: 'DejaVu Math TeX Gyre', serif; font-size: 26px; width: 90%; height: 30%; display: block; margin: 0 auto; border-radius: 5px; border: 1px solid; color: #3d3d3f; text-align: center;"><br><br>
				<button onclick="update()" py-click="fun2" style="background-color: #7dce94; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 16px; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; width: 100px;" onclick="myPlot1()" class="w3-btn">Predict</button>
		    	<p id="output2" style="font-size: 20px; font-family: Courier New, monospace; color:#17252A; text-align: center;"></p>
		    	<div id="chart" class="div" style=" color: red; min-width: 5%; min-height: 5%; max-width: 90%; max-height: 75%;"></div>
		  </div>
		</div>
	  <div class="w3-show-inline-block" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #17252A; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px; font-size: 26px; text-align: center;">
		  <div id="back_reset" class="w3-bar">
				<button onclick="my_back()" style="background-color: #3d3d3f; width: 100px; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 14px; font-family: Arial, Helvetica, sans-serif; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 50px;" class="w3-btn">BACK</button>
				<button onclick="my_reset()" style="background-color: #3d3d3f; width: 100px; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 14px; font-family: Arial, Helvetica, sans-serif; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 50px;" class="w3-btn">RESET</button>
			</div>
	  </div>
		<script>
			// Variables
		  var Panel1     = document.getElementById("Panel1");
		  var Panel2     = document.getElementById("Panel2");
		  var Plot       = document.getElementById("Plot");
		  var Value1     = document.getElementById("Value1");
		  var Value2     = document.getElementById("Value2");
		  var Compound1  = document.getElementById("compound1");
		  var Compound2  = document.getElementById("compound2");
			var back_reset = document.getElementById("back_reset");
			var operation  = document.getElementById("operation");

		  // Initialization
	    back_reset.style.display = "none";
	    Panel1.style.display     = "none";
	    Panel2.style.display     = "none";
	    Value1.style.display     = "none";
	    Value2.style.display     = "none";
	    Plot.style.display       = "none";
			document.getElementById("output1").innerHTML = "";
			document.getElementById("output2").innerHTML = "";
			document.getElementById("chart1").innerHTML  = "";

			function operation1() {
		    Panel1.style.display     = "block";
		    Panel2.style.display     = "none";
		    Value1.style.display     = "block";
		    Value2.style.display     = "block";
		    Plot.style.display       = "none";
		    back_reset.style.display = "block";
		    operation.style.display  = "none";
		    Compound1.value          = "Al0.14Ga0.5In0.36P0.328As0.242Sb0.430";
			}
			function operation2() {
		    Panel1.style.display     = "block";
		    Panel2.style.display     = "block";
		    Value1.style.display     = "none";
		    Value2.style.display     = "none";
		    Plot.style.display       = "block";
		    back_reset.style.display = "block";
		    operation.style.display  = "none";
		    Compound1.value          = "Al0.5Ga0.5P";
		    Compound2.value          = "Al0.5Ga0.5As";
			}

			function my_back() {
				operation.style.display  = "block";
				back_reset.style.display = "none";
		    Panel1.style.display     = "none";
		    Panel2.style.display     = "none";
		    Value1.style.display     = "none";
		    Value2.style.display     = "none";
		    Plot.style.display       = "none";
				document.getElementById("output1").innerHTML = "";
				document.getElementById("output2").innerHTML = "";
				document.getElementById("chart").innerHTML  = "";
			}

			function my_reset() {
				document.getElementById("output1").innerHTML = "";
				document.getElementById("output2").innerHTML = "";
				document.getElementById("chart").innerHTML  = "";
			}

			function update() {
				document.getElementById("output1").innerHTML = "";
				document.getElementById("output2").innerHTML = "";
				document.getElementById("chart").innerHTML  = "";
			}

		</script>
    <script type="py" async>
			import joblib
			import pandas as pd
			from sklearn.linear_model import Ridge
			import numpy as np
			import re
			from bokeh.plotting import figure, column
			from bokeh.models import ColumnDataSource, CustomJS
			from bokeh.embed import json_item
			from pyscript import window, document, fetch, ffi
			import warnings
			warnings.filterwarnings("ignore")

			# Initialization
			Bokeh = window.Bokeh   #pass Bokeh into the main threads window object
			ca = ["Al","Ga","In"]
			an = ["P","As","Sb"]
			Ridge_Eg_Gamma=joblib.load(open('./Ridge_Eg.pkl','rb'))# For Gamma Valley
			Ridge_Eg_X=joblib.load(open('Ridge_Ex.pkl','rb'))# For X Valley
			stepsize = 20
			ones = np.linspace(1,1,stepsize)
				

			def validate(compound,elements,fractions,status):
				ele_list  = re.findall('[a-z|A-Z][^A-Z]|[A-Z]', compound)
				fra_list  = re.findall('\d+.\d+|\d+', compound)
				if len(elements) != len(ele_list) or len(fractions) != len(fra_list):
					status = False

				return status 


			def elements_fractions(compound):
				fractions = []
				elements  = []
				duplicate = False
				if "+" in compound or "-" in compound:
					status = False
				else:
					my_list = re.findall('[A-Z][^A-Z]*', compound)
					actual_comp = ""
					tmp = []
					status = True
					for i in range(len(my_list)):
						try:
							try: elements.append(re.findall(r'[A-Z]*[a-z|\d+]', my_list[i])[0])
							except: elements.append(my_list[i])
							elements[i] = re.sub(r'\d+', '', elements[i])
							try: fractions.append(eval(re.findall(r'\d+\.\d*', my_list[i])[0]))
							except: fractions.append(eval(re.findall(r'\d+', my_list[i])[0]))
							tmp.append(fractions[i])
							if elements.count(elements[i]) > 1:
								duplicate = True
								break
						except:
							fractions.append(1.0)

						actual_comp = actual_comp + elements[i] + str(fractions[i])

					if duplicate != True: status = validate(compound,elements,tmp,status)
				return actual_comp.replace('1.0',''), elements, fractions, i, duplicate, status


			def neutrality_existence(elements,fractions):
				nc = 0
				na = 0
				exist   = True

				for i in range(len(elements)):
					if elements[i] in ca:
						nc = nc + fractions[i]
					elif elements[i] in an:
						na = na + fractions[i]
					else:
						exist = False
						break

				return exist, nc, na, i



			def check_compound(compound):
				try:
					compound, elements, fractions, idx, duplicate, status = elements_fractions(compound)
					if status == False:
						out = "Incorrect entry!!"
					elif duplicate == True:
						out = f"{elements[idx]} is repeated. Please make sure that each element is typed once"
					elif idx == 0:
						out = "Please enter more than one element."
					elif idx > 5:
						out = "Please enter only six different elements."
					else:
						exist, nc, na, idx = neutrality_existence(elements,fractions)

						if exist == False:
							out = f"{elements[idx]} does not exist. Please make sure that all elements are from the given set."
						elif nc != 1 and na != 1:
							out = "Charge neutrality is not maintained for both cations and anions."
						elif nc != 1:
							out = "Charge neutrality is not maintained for cations."
						elif na != 1:
							out = "Charge neutrality is not maintained for anions."
						else:
							try:
								out = pd.DataFrame({ca[0]:[0],ca[1]:[0],ca[2]:[0],an[0]:[0],an[1]:[0],an[2]:[0]})
								for n in range(len(elements)):
									out[elements[n]] = fractions[n]
							except:
								out = "Please check the typed compound is correct."
				except:
					out = "Incorrect entry!!"
				
				return out, compound


			async def plotting(GEG,XEG,steps):
				source = ColumnDataSource(data = dict(x=steps.tolist(),
				y1=GEG.tolist(),
				y2=XEG.tolist()))

				TOOLTIPS = [
				("Mole","$x"),
				("E","$y"),
				]

				p  = figure(x_range=(steps.min(),steps.max()+0.001), width=450, height=450, tooltips=TOOLTIPS, sizing_mode="stretch_both")
				p.line('x', 'y1', source=source, line_width=3, line_alpha=0.6, color="blue", legend_label="Gamma")
				p.line('x', 'y2', source=source, line_width=3, line_alpha=0.6, color="red", legend_label="X")
				p.legend.location = "top_left"
				p.legend.click_policy="hide"
				p.yaxis.axis_label = "Enegy [eV]"
				p.xaxis.axis_label = "Mole Fraction [x]"
				document.querySelector("#chart").replaceChildren()

				await Bokeh.embed.embed_item(ffi.to_js(json_item(p, "chart")))

			async def fun1(event):
				output_div = document.querySelector("#output1")
				compound = document.querySelector("#compound1").value
				try:
					Data, compound = check_compound(compound)
					if isinstance(Data, str):
						output_div.innerText = Data
					else:
						eg = min(Ridge_Eg_Gamma.predict(Data)[0],Ridge_Eg_X.predict(Data)[0])
						if Ridge_Eg_Gamma.predict(Data)[0] < Ridge_Eg_X.predict(Data)[0]:
							output_div.innerText = compound + " has a direct bandgap of " + str(round(eg,4)) + " eV."
						else:
							output_div.innerText = compound + " has an indirect bandgap of " + str(round(eg,4)) + " eV."
				except:
					output_div.innerText = "Unexpected error in your entry!! Please make sure of your compound."


			async def fun2(event):
				output_div1 = document.querySelector("#output1")
				output_div2 = document.querySelector("#output2")
				compound1 = document.querySelector("#compound1").value
				compound2 = document.querySelector("#compound2").value
				
				try:
					Data1, compound1 = check_compound(compound1)
					Data2, compound2 = check_compound(compound2)

					if isinstance(Data1, str):
						output_div1.innerText = Data1
					elif isinstance(Data2, str):
						output_div2.innerText = Data2
					else:
						difference = Data1.compare(Data2)
						my_dict = {}
						if difference.shape[1] == 4:
							col = difference.columns
							exist = [n[0] if n[0] in ca+an else False for n in col]
							first = False
							for i in ca+an:
								if i in exist:
									if first == False:
										steps = np.linspace(difference[(i,'self')][0],difference[(i,'other')][0],stepsize)
										first = True

									my_dict[i]= np.linspace(difference[(i,'self')][0],difference[(i,'other')][0],stepsize)
								else:
									my_dict[i] = Data1[i][0]*ones 
							
							Data = pd.DataFrame(my_dict)
							GEG = Ridge_Eg_Gamma.predict(Data)
							XEG = Ridge_Eg_X.predict(Data)
							await plotting(GEG,XEG,steps)
						else:
							output_div2.innerText = "Please make sure that you are varing the mole fraction between two cations or two anions only."
				except:
					output_div2.innerText = "Unexpected error in your entry!! Please make sure of your compound."


			async def update_data(event):
				await fun1(event)
				await fun2(event)
    </script>
  </body>
</html>